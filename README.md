# ttbike-spider
A simple crawler for hello-bike(ttbike)

## 一、结构

### 1. codePlatform.py

**由于批量抓取需要token池，本程序调用了某接码平台的API，实现自动获取手机号码和获取短信验证码。**

大家根据自身喜欢的平台，可自己重写该部分。如果你比较懒，那就用这家好了，至于是哪家，看代码url。

此部分功能比较简单，有空再补充

### 2. ttbikeSpider.py

**ttbikeSpider类继承自codePatform类，以实现自动登录ttbike、获取token**

### 3. main.py

**主函数**

### 4. test.py

**测试用函数**



## 二、使用

from ttbikeSpider import ttbikeSpider

ttbike=ttbikeSpider(token="",
	path=os.getcwd(),
	city="南京市",
	cityCode="025",
	adCode="320100",
	timeout=6,
	nums=2
	)
ttbike.run(118.90341,32.100929,118.93541,32.108229)

直接执行main.py即可，修改其中参数：

``` 
ttbikeSpider()
token:接码平台的token，必填*
path:保存文件的路径，默认当前文件夹，可选
city:抓取的数据所在的城市，默认南京市，必填*
cityCode:城市区号，默认025，必填*
adCode:行政区区号，默认210100，必填*
nums:token池数量，建议结合抓取点数量和时间间隔修改，默认20，可选
timeout:超时值，默认6，可选
```



 ```
ttbikeSpider.run(self,lng1,lat1,lng2,lat2)
分别为矩形区域的左下坐标和右上左边
 ```

抓取结果示例:

```
2019-06-25 07:39:19,3510695702,32.10063773717338,118.90410393476486,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,3110033332,32.100607320519465,118.90267163515091,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,7690485562,32.10052367472121,118.90425950288773,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,2700799438,32.10056423025976,118.90428632497787,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,3790335341,32.10011051517223,118.90321344137192,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,3510653714,32.10062252884642,118.90436679124832,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,7310601389,32.100493258067296,118.90448480844498,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,7690248976,32.10039693866324,118.90455454587936,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,7690232106,32.10047804974034,118.90479058027267,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,3790661958,32.100249924836,118.90144854784012,1.5元/30分钟, ,-1,0,0
2019-06-25 07:39:19,7690858624,32.10010798045108,118.90144854784012,1.5元/30分钟, ,-1,0,0
```



## 三、注意事项

- 请先运行test.py确保无异常
- 程序加入了token池维持功能，token过期后自动补充，请确保账户余额充足
- 请确保city，CityCode，adCode与输入的经纬度坐标相吻合，否则会出现”您所在的地区尚未开通“的错误
- 请确保使用高德经纬度坐标，不同地图的经纬度坐标有偏差，ttbike使用的是高德地图
- 在抓取的过程中请不要打开token池文件和单车文件，防止出现文件占用报错，可采取复制副本的方式查看
- readme太难写了，有空再补充，新手上路，请多关照。











